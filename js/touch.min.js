"use strict";!function($){var CURRENT_TOUCH,FIRST_TOUCH,GESTURE,GESTURES,HOLD_DELAY,TOUCH_TIMEOUT,_angle,_capturePinch,_captureRotation,_cleanGesture,_distance,_fingersPosition,_getTouches,_hold,_isSwipe,_listenTouches,_onTouchEnd,_onTouchMove,_onTouchStart,_parentIfText,_swipeDirection,_trigger,_current;_current=null,GESTURE={},FIRST_TOUCH=[],CURRENT_TOUCH=[],TOUCH_TIMEOUT=void 0,HOLD_DELAY=650,GESTURES=["singleTap","doubleTap","hold","swipe","swiping","swipeLeft","swipeRight","swipeUp","swipeDown","rotate","rotating","rotateLeft","rotateRight","pinch","pinching","pinchIn","pinchOut","drag","dragLeft","dragRight","dragUp","dragDown"],$.each({touch:"touchstart",tap:"tap"},function(e,n){$.fn[e]=function(e){return $(document.body).on(n,this,e)}}),$.each(GESTURES,function(e,n){$.fn[n]=function(e){return this.on(n,this.selector,e)}}),$(document).ready(function(){return _listenTouches()}),_listenTouches=function(){return $(document.body).on("touchstart",_onTouchStart).on("touchmove",_onTouchMove).on("touchend",_onTouchEnd).on("touchcancel",_cleanGesture)},_onTouchStart=function(e){var n,t,i,r;return i=Date.now(),n=i-(GESTURE.last||i),TOUCH_TIMEOUT&&clearTimeout(TOUCH_TIMEOUT),r=_getTouches(e),t=r.length,FIRST_TOUCH=_fingersPosition(r,t),GESTURE.el=$(_parentIfText(r[0].target)),GESTURE.fingers=t,GESTURE.last=i,1===t?(GESTURE.isDoubleTap=n>0&&n<=250,setTimeout(_hold,HOLD_DELAY)):2===t?(GESTURE.initial_angle=parseInt(_angle(FIRST_TOUCH),10),GESTURE.initial_distance=parseInt(_distance(FIRST_TOUCH),10),GESTURE.angle_difference=0,GESTURE.distance_difference=0):void 0},_onTouchMove=function(e){var n,t;return GESTURE.el&&(e.preventDefault(),t=_getTouches(e),n=t.length,n===GESTURE.fingers?(CURRENT_TOUCH=_fingersPosition(t,n),_isSwipe(e)&&_trigger("swiping"),2===n&&(_captureRotation(),_capturePinch())):_cleanGesture()),!0},_isSwipe=function(){var e,n,t;return t=!1,CURRENT_TOUCH[0]&&(e=Math.abs(FIRST_TOUCH[0].x-CURRENT_TOUCH[0].x)>30,n=Math.abs(FIRST_TOUCH[0].y-CURRENT_TOUCH[0].y)>30,t=GESTURE.el&&(e||n)),t},_onTouchEnd=function(){var e,n,t,i,r;return 1===GESTURE.fingers?_isSwipe()?(_trigger("swipe"),r=_swipeDirection(FIRST_TOUCH[0].x,CURRENT_TOUCH[0].x,FIRST_TOUCH[0].y,CURRENT_TOUCH[0].y),_trigger("swipe"+r),_cleanGesture()):GESTURE.isDoubleTap?(_trigger("doubleTap"),_cleanGesture()):TOUCH_TIMEOUT=setTimeout(function(){_trigger("singleTap"),_cleanGesture()},250):2===GESTURE.fingers?(e=!1,0!==GESTURE.angle_difference&&(_trigger("rotate",{angle:GESTURE.angle_difference}),i=GESTURE.angle_difference>0?"rotateRight":"rotateLeft",_trigger(i,{angle:GESTURE.angle_difference}),e=!0),0!==GESTURE.distance_difference&&(_trigger("pinch",{angle:GESTURE.distance_difference}),t=GESTURE.distance_difference>0?"pinchOut":"pinchIn",_trigger(t,{distance:GESTURE.distance_difference}),e=!0),!e&&CURRENT_TOUCH[0]&&(Math.abs(FIRST_TOUCH[0].x-CURRENT_TOUCH[0].x)>10||Math.abs(FIRST_TOUCH[0].y-CURRENT_TOUCH[0].y)>10)&&(_trigger("drag"),n=_swipeDirection(FIRST_TOUCH[0].x,CURRENT_TOUCH[0].x,FIRST_TOUCH[0].y,CURRENT_TOUCH[0].y),_trigger("drag"+n)),_cleanGesture()):void 0},_fingersPosition=function(e,n){var t=[],i=0;for(e=e[0].targetTouches?e[0].targetTouches:e;i<n;)t.push({x:e[i].pageX,y:e[i].pageY}),i++;return t},_captureRotation=function _captureRotation(){var angle,diff,i,symbol;if(angle=parseInt(_angle(CURRENT_TOUCH),10),diff=parseInt(GESTURE.initial_angle-angle,10),Math.abs(diff)>20||0!==GESTURE.angle_difference){for(i=0,symbol=GESTURE.angle_difference<0?"-":"+";Math.abs(diff-GESTURE.angle_difference)>90&&i++<10;)eval("diff "+symbol+"= 180;");return GESTURE.angle_difference=parseInt(diff,10),_trigger("rotating",{angle:GESTURE.angle_difference})}},_capturePinch=function(){var e,n;if(n=parseInt(_distance(CURRENT_TOUCH),10),e=GESTURE.initial_distance-n,Math.abs(e)>10)return GESTURE.distance_difference=e,_trigger("pinching",{distance:e})},_trigger=function(e,n){if(GESTURE.el)return n=n||{},CURRENT_TOUCH[0]&&(n.iniTouch=GESTURE.fingers>1?FIRST_TOUCH:FIRST_TOUCH[0],n.currentTouch=GESTURE.fingers>1?CURRENT_TOUCH:CURRENT_TOUCH[0]),GESTURE.el.trigger(e,n)},_cleanGesture=function(){return FIRST_TOUCH=[],CURRENT_TOUCH=[],GESTURE={},clearTimeout(TOUCH_TIMEOUT)},_angle=function(e){var n=e[0],t=e[1],i=Math.atan(-1*(t.y-n.y)/(t.x-n.x))*(180/Math.PI);return i<0?i+180:i},_distance=function(e){var n=e[0],t=e[1];return-1*Math.sqrt((t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y))},_getTouches=function(e){var n=e.originalEvent||e;return n.touches||[n]},_parentIfText=function(e){return"tagName"in e?e:e.parentNode},_swipeDirection=function(e,n,t,i){return Math.abs(e-n)>=Math.abs(t-i)?e-n>0?"Left":"Right":t-i>0?"Up":"Down"},_hold=function(){if(GESTURE.last&&Date.now()-GESTURE.last>=HOLD_DELAY)return _trigger("hold"),_cleanGesture()}}(jQuery);